<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <div class="mermaid">
    sequenceDiagram
        actor User
        participant Identity as Azure.Identity
        participant Client as AIProjectClient
        participant Agent as HealthAdvisorAgent
        participant Thread as ConversationThread
        participant Service as Azure AI Agent Service
        participant Model as GPT-4-Mini Model

        %% Authentication & Setup
        User->>Identity: Authenticate (DefaultAzureCredential)
        Identity-->>User: Return credentials
        User->>Client: Initialize with connection string

        %% Agent Creation
        User->>Client: Create health advisor agent
        Client->>Service: Create agent request
        Service->>Model: Configure with GPT-4-Mini
        Service-->>Client: Return agent ID
        Client-->>User: Return agent instance

        %% Thread Creation
        User->>Client: Create conversation thread
        Client->>Service: Create thread request
        Service-->>Client: Return thread ID
        Client-->>User: Return thread instance

        %% Message Flow
        rect rgb(200, 200, 240)
            Note over User,Model: Message Processing Loop
            User->>Client: Send health question
            Client->>Thread: Add message to thread
            Client->>Service: Create run (process message)
            
            loop Run Status Check
                Client->>Service: Check run status
                Service-->>Client: Return status (queued/in_progress)
                alt Status Complete
                    Service->>Model: Process with instructions
                    Model-->>Service: Return response
                    Service-->>Client: Return completed status
                else Status Failed
                    Service-->>Client: Return error status
                end
            end
            
            Client->>Thread: Retrieve messages
            Thread-->>User: Display conversation history
        end

        %% Optional Cleanup
        opt Cleanup
            User->>Client: Delete agent
            Client->>Service: Delete agent request
            Service-->>Client: Confirm deletion
            Client-->>User: Return cleanup status
    end
  </div>
  <script>mermaid.initialize({startOnLoad:true});</script>
</body>
</html>
